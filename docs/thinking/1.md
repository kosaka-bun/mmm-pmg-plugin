# 思考笔记（1）

### 【已处理】若是一个声部有一个很长的保持音，另一个声部有很多很短且有重复的单音，这也被算在复音中，应如何计算这种超大复音的指法？

可尝试以下方案：
1. 复音中不同的音高的单音数超过5个，就不再将后面的音加入复音，继续按原逻辑处理。（还可以避免5音以上柱式和弦被作为复音）
2. 将整个复音按起始帧号排序后，按单音序列处理。

<hr>

### 如果有一堆连续三度双音，目前的算法并不能很好支持这种音型的指法计算。

可以尝试把六度及以下的双音计入单音序列中，比如，一段递增的单音序列后出现了双音，则计算此双音的音符号均值，若大于序列中最后一个音符号，则将其加入单音序列中。

如此，即使是一堆连续双音，若这些双音有一定趋势，也能较准确计算指法。

亦可单独定义一个序列，用于存储六度及以下双音序列，根据它们的趋势来计算指法。

三音及以上复音连续出现时，仅能反复跳跃。

<hr>

### 如何计算半音阶指法？

<hr>

### 如何判断缩指，即(#G #A) (#G #F F)问题？

<hr>

### 有一种情况必须用3指，(#G #A) (#G #F F)，应当如何处理？

并不是必须用3指，可以2 4 3 2 1，只是如何判断缩指的问题。

若一个下行序列的前一个音是单音且高于序列的第一个音，则可在序列不能推导出自然指法的情况下，对序列的前一个音的已编指法进行修正，但只能用大于已编手指号的手指进行修正。

如：已编为3指，就不能用3以下的手指进行修正。

下行序列的前一个音为单音，且高于序列的第一个音，则此单音必定属于一个上行序列的最后一个音。

更改指法会使手掌模型在弹奏被更改指法的音时，使用错误的指法，产生错误的手型位置信息。可以在每个弹奏一个音，记录一次手型位置，更改指法后，从更改指法的音的前一个音所处的位置进行计算。

如此，应将手型信息类和手指类更改为结构体。（批注：不适用，仅将演奏每个音后的手指手腕位置对象克隆后存入音符基类的成员中即可）

当然也可以在所有指法计算完成后再依次弹奏所有音符，来计算每个音符的手型。但缺点是不能在指法计算过程中获得离某个音最近的手指了。

修正可以通过将序列的前一个音加入序列中，并放在首位，再对新的序列进行计算，此时应将用于计算的手型模型的位置置为新序列的前一个音所保存的位置。

<hr>

### 上升序列最后一个音使用5指，然后下一个音是更高的三音复音，用5指不够自然。

对音符序列进行改进，使之既支持单音又支持复音，复音的音高，用复音中**不同音高的音**的**平均音高**来表示。

也可以在各个计算最后一个音的指法的算法处，单独对这类复音进行判断。

<hr>

### 单个手指的演奏动作需要哪些关键帧？

1. 在音符开始帧的最多30帧前保存演奏前状态（取决于此手指演奏的上一个音符的结束帧）。
2. 开始帧前第2帧，移动到指定位置。
3. 开始帧处，弹下按键。
4. 结束帧前2帧保存弹下的当前状态。
5. 结束帧处，抬起手指。